"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}define(["SwiftOtter_Test/js/api.babel","SwiftOtter_Test/js/token-management.babel","SwiftOtter_Test/js/currency-management.babel","SwiftOtter_Test/js/renderer/test-form.babel","SwiftOtter_Test/js/renderer/results.babel","SwiftOtter_Test/js/renderer/progress.babel","SwiftOtter_Test/js/model/slide-factory.babel","SwiftOtter_Test/js/ga.babel"],function(i,t,r,n,s,o,a,l){function c(n){var s=this;return new Promise(function(e,i){if(!s.test)return t.getToken().then(function(t){return function(t,e,i,n){var s=this;this.api.test(this.config.id,e.client_id).then(function(t){s.tokenId=e.client_id,s.test=t,r.setCurrency(t.currency),i(t)})}.call(s,n,t,e,i)});e(s.test)})}function u(t,e,i){var n=!0,s=d.call(this,this.currentQuestion);if(0<s&&!i&&(n=function(t){var e=this.wrapper.querySelector('.test-question[data-question-id="'.concat(t,'"]')),i=e.querySelector(".test-question__error");if(e.classList.contains("test-question--payment")||e.classList.contains("test-question--intro")||e.classList.contains("test-question--confirm"))return!0;var n=this.wrapper.querySelectorAll('.test-question[data-question-id="'.concat(t,'"] input:checked'));NodeList.prototype.isPrototypeOf(n)||(n=[n]);var s=Array.prototype.map.call(n,function(t){return t.getAttribute("data-answer-id")}),r=parseInt(e.getAttribute("data-correct-count"));return r!==s.length?(i.style.display="inline-block",i&&(i.innerText="You need to select "+r+" answer"+(1<r?"s":"")+"."),!1):(i.style.display="none",this.api.answer(this.config.id,this.tokenId,t,s),!0)}.call(this,s)),!n)return!1;this.lastQuestion=this.currentQuestion,this.currentQuestion=t;var r=this.wrapper.querySelector('.test-question[data-question-id="'.concat(d.call(this,0),'"]')),o=this.wrapper.querySelector('.test-question[data-question-id="'.concat(d.call(this,this.lastQuestion),'"]')),a=this.wrapper.querySelector('.test-question[data-question-id="'.concat(d.call(this,this.currentQuestion),'"]'));"forward"===e?(r&&r.classList.remove("test-question--active"),o.nextSibling?o.parentNode.insertBefore(a,o.nextSibling):o.parentNode.appendChild(a)):"back"===e&&o.parentNode.insertBefore(a,o),o.classList.remove("test-question--active"),a.classList.add("test-question--active"),a.classList.contains("test-question--payment")&&l.checkoutPage(),parseInt(window.getComputedStyle(a).getPropertyValue("height"))>document.body.clientHeight?this.wrapper.classList.add("test-questions--top"):this.wrapper.classList.remove("test-questions--top"),this.slides.length>this.currentQuestion&&this.slides[this.currentQuestion].afterShow&&this.slides[this.currentQuestion].afterShow(),this.slides.length>this.lastQuestion&&this.slides[this.lastQuestion].afterHide&&this.slides[this.currentQuestion].afterHide();var c=new CustomEvent("test:change-question",{detail:{direction:e,firstQuestion:r,lastQuestion:o,current:a,newIndex:t,total:this.test.questions.length,sender:this}});document.body.dispatchEvent(c)}function d(t){return this.test.questions[t].id}function h(e){var t=this.test.questions.filter(function(t){return t.id==e});return!(!t||!t.length)&&this.test.questions.indexOf(t[0])}function p(t){var e=this;this.wrapper.classList.add("is-loading"),this.lastQuestion=0,this.currentQuestion=0,this.progress.complete(),this.api.finish(this.tokenId,this.config.id).then(function(t){return function(t){this.wrapper.classList.remove("is-loading"),this.resultsRenderer.render(this.tokenId,t),this.lastTest=this.test,this.test=void 0,function(){var e=this;this.wrapper.querySelector(".test-question__restart").addEventListener("click",function(t){confirm("Are you sure you want to restart this test? If you have already paid for it, you will need to pay again to take the entire test. We put the price low so you can take it a number of times without hurting your wallet.")&&(e.wrapper.classList.add("is-loading"),e.populateTest.call(e,t))}),this.wrapper.querySelector(".test-question__close").addEventListener("click",function(t){confirm("Are you sure you want to close this test? If you have already paid for it, you will need to pay again to take the entire test. We put the price low so you can take it a number of times without hurting your wallet.")&&(y.call(e,t),e.populateTest(t))})}.call(this)}.call(e,t)})}function f(){var e=this;this.wrapper.querySelectorAll(".test-question__previous").forEach(function(t){return t.addEventListener("click",function(t){return function(t){u.call(this,Math.max(0,this.currentQuestion-1),"back")}.call(e,t)})}),this.wrapper.querySelectorAll(".test-question__next").forEach(function(t){return t.addEventListener("click",function(t){return function(t){u.call(this,this.currentQuestion+1,"forward")}.call(e,t)})}),this.wrapper.querySelectorAll(".test-question__next-first-question").forEach(function(t){return t.addEventListener("click",function(t){return function(t){var e=this.test.questions.filter(function(t){return 0<t.id})[0];u.call(this,h.call(this,e.id),"forward")}.call(e,t)})}),this.wrapper.querySelectorAll(".test-question__goto-survey").forEach(function(t){return t.addEventListener("click",function(t){return function(t){var e=this.wrapper.querySelector(".test-question--survey"),i=h.call(this,e.getAttribute("data-question-id"));u.call(this,i)}.call(e,t)})}),this.wrapper.querySelectorAll(".test-question__complete").forEach(function(t){return t.addEventListener("click",function(t){return p.call(e,t)})})}function y(t){this.open=!1,document.body.classList.remove("modal-open"),this.wrapper.style.display="none",t.preventDefault()}function _(){var e=this;this.launcher.addEventListener("click",function(t){l.addToCart(),this.open=!0,document.body.classList.add("modal-open"),this.wrapper.style.display="block",dataLayer.push({event:"launchTest",test:this.config.name}),t.preventDefault()}.bind(this)),document.addEventListener("keypress",function(t){return 27===t.keyCode&&y.call(e,t)})}function m(){var a=this;document.body.addEventListener("test:reloadData",function(t){a.currentQuestion;a.lastTest||(a.lastTest=a.test),a.test=t.detail.testData,jsonConfig.question_detail.total=t.detail.details.test.questions.length,a.displayTest(t.detail.testData);var e=function(){var t=this.test.questions.filter(function(t){return 0<t.id&&(e=t.correct_count,!(t.answers.filter(function(t){return t.is_chosen}).length>=e));var e});return 0<t.length?t[0].id:this.test.questions.filter(function(t){return 0<t.id})[0].id}.call(a);u.call(a,h.call(a,e),"forward",!0);var i,n,s,r,o=a.wrapper.querySelector('.test-question[data-question-id="'.concat(d.call(a,a.currentQuestion),'"]'));o&&o.appendChild((i=t.detail.details.total,n=t.detail.details.email,s=t.detail.details.order_number,r='\n      <div class="payment__status">\n        You are on your way to being better prepared. '.concat(i," has been charged for your order: #").concat(s,".\n        You will have a receipt in your email, ").concat(n,".\n      </div>\n    "),document.createRange().createContextualFragment(r).firstElementChild))}),document.body.addEventListener("test:refresh",function(t){a.test=void 0,a.populateTest()})}return function(){function e(t){_classCallCheck(this,e),window.dataLayer=dataLayer||[],l.init(),this.config=t,this.api=new i({urls:{}}),this.open=!1,this.slideFactory=new a(this.config),this.container=t.launcher.parentNode.parentNode,this.launcher=t.launcher,this.wrapper=this.container.querySelector(".test__wrapper"),this.renderer=new n(this.wrapper.querySelector(".test-question-container"),this.config),this.resultsRenderer=new s(this.wrapper.querySelector(".test-question-container"),this.config),this.progress=new o(this.config,this.wrapper),this.lastQuestion=0,this.currentQuestion=0,this.slides=[],m.call(this),function(){var t=document.createElement("div");t.classList.add("test-closer"),t.innerHTML=this.config.icons.close,this.wrapper.appendChild(t),t.addEventListener("click",y.bind(this)),document.body.appendChild(this.wrapper),this.wrapper.style.display="none"}.call(this),_.call(this)}return _createClass(e,[{key:"populateTest",value:function(){var e=this;return c.call(this,this.config.id).then(function(t){return e.displayTest(t)})}},{key:"displayTest",value:function(t){jsonConfig.logged_in=t.logged_in,jsonConfig.customer_name=t.customer_name,jsonConfig.customer_email=t.customer_email,this.config.formatted_price=t.formatted_price,jsonConfig.price=t.price,jsonConfig.unlimited_price=t.unlimited_price,jsonConfig.formatted_price=t.formatted_price,jsonConfig.has_unlimited_price=t.has_unlimited_price,jsonConfig.formatted_price_unlimited=t.formatted_unlimited_price,jsonConfig.currency_code=t.currency_code,jsonConfig.country=t.country,jsonConfig.all_features_available=t.all_features_available,jsonConfig.question_detail.total=t.total_questions_available,this.slides=function(t){var e=this;return t.questions.map(function(t){return e.slideFactory.create(t)})}.call(this,t),this.renderer.render(this.slides),this.wrapper.classList.remove("is-loading"),this.updatePricing(t),this.progress.startOver();var e=this.launcher.querySelector("span");void 0!==e&&(e.innerText=this.config.button_text),f.call(this)}},{key:"updatePricing",value:function(e){var t=document.querySelectorAll(".test__price"),i=document.querySelectorAll(".test__price-unlimited"),n=document.querySelectorAll(".test__price-no-tax"),s=document.querySelectorAll(".test__price-unlimited-no-tax"),r=e.has_vat?" (VAT included)":"";0<t.length&&Array.prototype.forEach.call(t,function(t){t.innerText=e.formatted_price+r}),0<i.length&&Array.prototype.forEach.call(i,function(t){t.innerText=e.formatted_unlimited_price+r}),0<n.length&&Array.prototype.forEach.call(n,function(t){t.innerText=e.formatted_price}),0<s.length&&Array.prototype.forEach.call(s,function(t){t.innerText=e.formatted_unlimited_price})}}]),e}()});
//# sourceMappingURL=test.babel.min.js.map
